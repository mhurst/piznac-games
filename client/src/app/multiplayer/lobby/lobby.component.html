<div class="lobby-page">
  <div class="lobby-container">
    <h1 class="title">{{ displayGameType | uppercase }}</h1>

    @if (!roomCode && !joining) {
      <div class="lobby-options">
        <div class="option-card">
          <h2>Create Game</h2>
          <input
            type="text"
            [(ngModel)]="playerName"
            placeholder="Your name"
            class="input"
            maxlength="20"
          />
          <button (click)="createRoom()" class="btn btn-create" [disabled]="!playerName.trim()">
            Create Room
          </button>
        </div>

        <div class="divider">OR</div>

        <div class="option-card">
          <h2>Join Game</h2>
          <input
            type="text"
            [(ngModel)]="playerName"
            placeholder="Your name"
            class="input"
            maxlength="20"
          />
          <input
            type="text"
            [(ngModel)]="joinCode"
            placeholder="Room code"
            class="input"
            maxlength="4"
            (input)="joinCode = joinCode.toUpperCase()"
          />
          <button (click)="joinRoom()" class="btn btn-join" [disabled]="!playerName.trim() || !joinCode.trim()">
            Join Room
          </button>
        </div>
      </div>
    }

    @if (roomCode && !gameStarted) {
      <div class="waiting-room">
        @if (roomPlayers.length > 0) {
          <h2>Players in Room ({{ roomPlayers.length + aiCount }}/{{ maxPlayers }})</h2>
          <div class="player-list">
            @for (player of roomPlayers; track player.id) {
              <div class="player-entry">{{ player.name }}</div>
            }
            @if (aiCount > 0) {
              <div class="player-entry ai-entry">+ {{ aiCount }} AI bot{{ aiCount > 1 ? 's' : '' }}</div>
            }
          </div>
          @if (isPokerGame && isHost) {
            <div class="ai-selector">
              <label>AI Opponents:</label>
              <select [(ngModel)]="aiCount">
                @for (n of [0, 1, 2, 3, 4]; track n) {
                  @if (n <= maxAiBots) {
                    <option [ngValue]="n">{{ n === 0 ? 'None' : n + ' Bot' + (n > 1 ? 's' : '') }}</option>
                  }
                }
              </select>
            </div>
          }
          @if (canStart) {
            <button (click)="startGame()" class="btn btn-create" style="margin-top: 16px;">
              Start Game
            </button>
          } @else if (!isHost) {
            <p class="waiting-text">Waiting for host to start...</p>
          } @else {
            <p class="waiting-text">Need at least 2 players to start</p>
          }
        } @else {
          <h2>Waiting for opponent...</h2>
        }
        <div class="room-code-display">
          <p>Share this code:</p>
          <div class="code">{{ roomCode }}</div>
        </div>
      </div>
    }

    @if (joining && !roomCode) {
      <div class="waiting-room">
        <h2>Joining room...</h2>
      </div>
    }

    @if (error) {
      <div class="error">{{ error }}</div>
    }

    <button (click)="goBack()" class="btn btn-back">Back to Games</button>
  </div>

  <app-players-sidebar></app-players-sidebar>
</div>
